<div class="container"> 
   
    <% if current_usuario.rol == 'admin' %>
        <%= render template: "siged/menuAdmin" %>
    <% elsif current_usuario.rol == 'docente' %>
        <%= render template: "siged/menuDocente" %>
    <% end %>

    <h3 id="align-title">Estadísticas de Valoración del Servicio Social</h3>
    <div class="row">
        <div class="col-md-7">
             <% if can? :create, EstadisticaServicio %>
                <%= button_to new_estadistica_servicio_path, :class => "btn btn-primary", title: "Nuevo periodo", :method => :get do %>
                    <span class="glyphicon glyphicon-plus"></span>
                <% end %>
             <% end %>
        </div>
        <%= form_tag estadistica_servicios_path, :method => 'get' do %>
        <div class="col-md-2">
          <%= select_tag :periodo, options_for_select([["",""],["FEB-JUN", "FEB-JUN/"], ["AGOS-DIC", "AGOS-DIC/"]], params[:periodo]), class: "form-control" %>
                </div>
                <div class="col-md-2">
                    <%= number_field_tag :anio, params[:anio], min: 2010, class: "form-control", placeholder: "Año" %>
                </div>
                <div class="col-md-1">
                    <%= button_tag(type: 'submit', class: "btn btn-default", title: "Buscar") do %> <span class="glyphicon glyphicon-search"></span><% end %>
                </div>                
      <% end %>    
    </div>    
    <div class="row">  
    <table class="table" id="archivos">
        <thead>
            <tr>                            
                <th class="info">Empresa</th> 
                <th class="info">Alumnos</th> 
                <th class="info">Primer bimestre</th>
                <th class="info">Segundo bimestre</th>
                <th class="info">Tercer bimestre</th>
                <th class="info">Promedio Final</th> 
                <th class="info">Desempeño</th>
            </tr>
        </thead>        
       <% @servicios.each do |s| %> 

            <tbody>
                <td class="active"><%= s.nombreE %></td>
                <%# a = ServicioSocial.where(id_servicio_social:)%>
                <td class="active"></td>  
                <% x = EvaluacionServicio.where(id_servicio_social: s.id) %>
                <% @q = [0,0,0] %>
                <% @contador = 0 %> <%# criterios%>
                <% contadorR = 0 %> <%# contador bimestres%>
                <% x.each do |y| %>
                    <% a = y.criterio_evalucion_servicios%>
                    <% if contadorR < 3 %>
                        <% a.each do |b| %>
                            <% @q[contadorR] = @q[contadorR]+ b.calificacion_criterio %>
                            <% @contador = @contador+1 %>                            
                        <% end %>
                    <% @q[contadorR] = @q[contadorR].to_f/@contador.to_f %>                    
                    <% contadorR = contadorR+1 %>
                    <% end %>
                    
                <% end %>

                <td class="active"><%= @q[0].round(2) %></td>                
                <td class="active"><%= @q[1].round(2) %></td>                
                <td class="active"><%= @q[2].round(2) %></td>                
                <td class="active">
                    <%= promedio = ((@q[0]+@q[1]+@q[2])/3).round(2) %>
                </td>
                
                <% a=  Tablapromedio.where('valor_min <= ? and valor_max >= ?', promedio, promedio)%>
                <%#binding.pry %>
                
                <%# sería algo así creo%>
                <td class="active">
                <% if a[0].nivel_desem!='Insuficiente'%>

                 Competencia alcanzada
                 <%else %>
                 Competencia <STRONG>NO</STRONG> alcanzada
                 <% end%>
                 <%#= a[0].nivel_desm %>
                  <%# link_to edit_periodo_curs_materia_estadistica_path(@periodo, archivos), :title => "Editar" do%> 
                  <%# link_to archivos, :method => :delete, data: { confirm: '¿Seguro que desea eliminar esta evidencia?' }, :title => "Eliminar" do %>                        
                 </td>
                 <td class="active">
                 </td>
            </tbody>
            <% end %>
        </table>
        <h6 id="align-title">Los valores de los promedios y el promedio final, muestran el nivel de desempeño del prestador del Servicio Social, de acuerdo a la siguiente tabla: </h6>
       
        <table class="tg" style="undefined;table-layout: fixed; width: 502px, " align="center">
        <colgroup>
        <col style="width: 214px">
        <col style="width: 201px">
        <col style="width: 87px">
        </colgroup>
          <tr>
            <th class="tg-hgcj">Desempeño</th>
            <th class="tg-hgcj">Niveles de desempeño</th>
            <th class="tg-hgcj">Escala</th>
          </tr>
          <tr>
            <td class="tg-s6z2" rowspan="4">Competencia Alcanzada</td>
            <td class="tg-s6z2">Excelente</td>
            <td class="tg-s6z2">3.50 a 4.00</td>
          </tr>
          <tr>
            <td class="tg-s6z2">Notable</td>
            <td class="tg-s6z2">2.50 a 3.49</td>
          </tr>
          <tr>
            <td class="tg-baqh">Bueno</td>
            <td class="tg-baqh">1.50 a 2.49</td>
          </tr>
          <tr>
            <td class="tg-baqh">Suficiente</td>
            <td class="tg-baqh">1.00 a 1.49</td>
          </tr>
          <tr>
            <td class="tg-baqh">Competencia NO Alcanzada</td>
            <td class="tg-baqh">Insuficiente</td>
            <td class="tg-baqh">0.00 a 0.99</td>
          </tr>
        </table>


        <%# will_paginate @archivos %>
    </div>
</div>    
            
        <%# will_paginate @archivos %>
    </div>
</div>
<p id="notice"><%= notice %></p>