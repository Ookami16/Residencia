<div class="container">
<%  x = Estudiante.find_by(email: current_usuario.email).servicio_sociales[0].id %>   
<% q = EvaluacionResidencia.where(id_residencia: x).order(:num_reporte).last%>  
<%#binding.pry%>
<% if q ==nil%>
      <% q = 1 %>
<% else %>
     <% q = q.num_reporte + 1 %>
<% end %>

<% if q <= 6 %>
  <%= nested_form_for @evaluacion_residencia, validate: true do |f| %>  
    <div id="marco">
      <div class="container">
        <div class="row">
          <span class="label label-warning" style="font-size: 20px; color: #000" >Formato de Evalucion Residencia</span>
        </div>
        <div class="row">            
          
        <%= f.hidden_field :id_residencia, value: x %></div>
      </div>
      <div class="row">
        <div class="col-xs-6 col-sm-4"><%= f.label "Numero de Reporte" %><br>
          
          <%= f.number_field :num_reporte , value: q,:readonly => true,style: 'width:10%;' %></div>
      </div>
      <div class="row">
        <div class="col-xs-6 col-sm-4"><p><%= f.label :Pdf,"Pdf Evalucion del Residencia" %>: <%= f.file_field :pdf , validate: true,accept: 'application/pdf'%></p></div>
        </div> 

      <div class="row">
        <%= f.hidden_field :fecha_registro, :value=>Date.today %>        
      </div>    
      <fieldset id="criterios">
            <h5 id="align-title"><b><span class="label label-warning" style="font-size: 20px; color: #000" >Registro de criterios evaluados  en Residencia Profesional
            </span></b></h5>
            <div class="row"><h5 id="align-title">
            <%=f.label "Registre su nivel de desempeÃ±o de acuerdo al formato que previamente subido "%>
            </div></h5>          
          <% ca =CatCriterioEvalResidencia.all%>
          <% for c in ca %>
              <%= f.fields_for :criterio_evaluacion_residencia, validate: true do |actdoc| %>
              <%# t.integer  "id_cat_criterio_eval",   limit: 4
                  t.integer  "calificacion_criterio",  limit: 4 %>
                  <div class="row">                  
                      <div class="col-md-10">
                          <%= c.criterio_eval%>
                          <%= actdoc.hidden_field :id_cat_criterio_eva, value: c.id %>
                      </div>
                      <div class="col-md-2">
                      <%= actdoc.number_field :calificacion_criterio, style: 'width:30%;'  %>
                          <%#= actdoc.number_field :calificacion_criterio, class: "form-control"%>
                      </div>
                      
                  </div>
              <% end %>
          <% end %>            
        </fieldset>
                            
      <div class="row" id="btn-cancelar">
        <div class="col-xs-2 col-md-4" id="btn">
          <%= f.submit :Continuar, :class => 'btn btn-success', data:{ confirm: 'Seguro que desea Continuar?'} %>
        </div>   
    <% end %>
  <% else %>
  <span class="label label-warning" style="font-size: 20px; color: #000" >Ya ha registrado sus tres reportes</span>
  <% end %>
        <div class="col-xs-2 col-md-4">
          <%= button_to "Cancelar",banco_proyectos_path, :class => 'btn btn-warning', :method => :get %>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>
