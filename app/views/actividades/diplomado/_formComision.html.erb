<div class="container">
    <div class="col-xs-6 col-sm-10" id="marco">
        <h4 id="align-title">Generar Oficio de Comisión sin Viáticos</h4>
        <% @mod = ModuloDiplomado.find_by(actividad_id: @actividad.id) %>
        <% if @mod == nil %>
            <% @ad = ActividadDocente.where(actividad_id: @actividad.id) %>
            <% for acd in @ad %>
                <% s = existe(@actividad.id, acd.docente_id) %>
                <% if s == true %>
                <% else %>
                    <h5><b>Datos del documento: </b></h5>
                    <%= form_tag(actividad_path, method: 'get') do %>
                        <% @arre = serie %>
                        <%= hidden_field_tag :format, "pdf"%>
						<div class="row">
                            <% d = Docente.find(acd.docente_id) %>
							<%= hidden_field_tag :docente, acd.docente_id %>
                            <div class="col-md-4"><b>Docente: </b> <%= d.nombreD %> <%= d.apPaterno %> <%= d.apMaterno %></div>
							<div class="col-md-4"><b>Cargo: </b>
                                <% @p = Puesto.find_by(docente_id: @idoc) %>
                                <% if @p != nil %>
                                    <% @a = CatTipoPuesto. find(@p.cat_tipo_puesto_id).nombrePuesto%>
                                    <%= select_tag :puesto, options_for_select([["DOCENTE", "DOCENTE"],[@a.upcase, @a.upcase]], "DOCENTE") %>
                                <% else %>
                                    <%= select_tag :puesto, options_for_select([["DOCENTE", "DOCENTE"]], "DOCENTE") %>
                                <% end %>
                            </div>
							<div class="col-md-4"><b>Firma: </b>
								<% catTP = CatTipoPuesto.find_by(nombrePuesto: 'Jefe del Departamento de Sistemas y Computacion') %>
								<% @p = Puesto.find_by(cat_tipo_puesto_id: catTP.id, estado: 'Activo') %>
								<% director = Configuracion.find_by(tipo: 'Director del Instituto Tecnologico de Oaxaca').contenido %>
								<% subDirector = Configuracion.find_by(tipo: 'Subdirector academico').contenido %>
                                <% if @p != nil %>
                                	<% @a = Docente.find(@p.docente_id) %>
                                   	<%= select_tag :firma, options_for_select([[@a.nombreD + " " + @a.apPaterno + " " + @a.apMaterno, @a.curp], [director, director], [subDirector, subDirector]]), class: "form-control" %>
								<% end %>
							</div>
                        </div>
                        <div class="row">
                            <div class="col-md-4"><b>No. Oficio: </b><%= select_tag "numero", options_for_select(@arre, "xD") %></div>
                            <% fec = Time.now
                            f = fec.strftime("%d")+ "/" + fec.strftime("%m") + "/" + fec.strftime("%Y") %>
                            <div class="col-md-4"><b>Fecha: </b><%= text_field_tag "fecha", f , 'data-behaviour'=> 'datepicker' %></div>
							<div class="col-md-4"><%= submit_tag "Generar", :class => 'btn btn-success' %></div>
                        </div>
                    <% end %>
                <% end %>
            <% end %>
        <% else %>
            <% @actividad.modulo_diplomados.each do |p| %>
                <% docmod = p.actividad_docentes.map(&:docente_id) %>
                <% if docmod == [] %>
                <% else %>
                    <% for dm in docmod %>
                        <% s = existeOAM(@actividad.id, dm, p.id) %>
                        <% if s == true %>
                        <% else %>
                            <h5><b>Datos del documento: </b></h5>
                            <%= form_tag(actividad_path, method: 'get') do %>
                                <% @arre = serie %>
                                <%= hidden_field_tag :format, "pdf"%>
								<div class="row">
                                    <% d = Docente.find(dm) %>
                                    <div class="col-md-4"><b>Docente: </b> <%= d.nombreD %> <%= d.apPaterno %> <%= d.apMaterno %> <%= hidden_field_tag :docente, dm %></div>
									<div class="col-md-4"><b>Cargo: </b>
                                        <% @p = Puesto.find_by(docente_id: @idoc) %>
                                        <% if @p != nil %>
                                            <% @a = CatTipoPuesto. find(@p.cat_tipo_puesto_id).nombrePuesto%>
                                            <%= select_tag :puesto, options_for_select([["DOCENTE", "DOCENTE"],[@a.upcase, @a.upcase]], "DOCENTE") %>
                                        <% else %>
                                            <%= select_tag :puesto, options_for_select([["DOCENTE", "DOCENTE"]], "DOCENTE") %>
                                        <% end %>
                                    </div>
                                    <div class="col-md-4"><b>Módulo: </b><%= p.nombreModulo %><%= hidden_field_tag :modulo, p.id %></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><b>No. Oficio: </b><%= select_tag "numero", options_for_select(@arre, "xD") %></div>
                                    <% fec = Time.now
                                    f = fec.strftime("%d")+ "/" + fec.strftime("%m") + "/" + fec.strftime("%Y") %>
                                    <div class="col-md-3"><b>Fecha: </b><%= text_field_tag "fecha", f , 'data-behaviour'=> 'datepicker' %></div>
                                    <div class="col-md-4"><b>Firma: </b>
										<% catTP = CatTipoPuesto.find_by(nombrePuesto: 'Jefe del Departamento de Sistemas y Computacion') %>
										<% @p = Puesto.find_by(cat_tipo_puesto_id: catTP.id, estado: 'Activo') %>
										<% director = Configuracion.find_by(tipo: 'Director del Instituto Tecnologico de Oaxaca').contenido %>
										<% subDirector = Configuracion.find_by(tipo: 'Subdirector academico').contenido %>
										<% if @p != nil %>
											<% @a = Docente.find(@p.docente_id) %>
											<%= select_tag :firma, options_for_select([[@a.nombreD + " " + @a.apPaterno + " " + @a.apMaterno, @a.curp], [director, director], [subDirector, subDirector]]), class: "form-control" %>
										<% end %>
									</div>
									<div class="col-md-2"><%= submit_tag "Generar", :formtarget => '_blank', class: 'btn btn-success' %></div>
                                </div>
                            <% end %>
                        <% end %>
                    <% end %>
                <% end %>
            <% end %>
        <% end %>
    </div>
</div>